---
title: ミスってしまった時の対処法
---
ここまで、Gitのコマンドを実行していきましたが、人間がやることなので、Typoややっぱりこっちが良いなどで前のコマンドをなかったことにしたり、リカバリしたいことがあります
ここでは、そんな時の対処法になります
なお、以前までのチャプターは実行までしていましたが、このチャプターは紹介だけになります
実際にどうなるのかは、作った環境で試してみてください

# ローカル編

まずはローカル編から

:::message alert
リカバリしたいブランチやファイルを既にリモートリポジトリに反映させてしまった場合、リモート編の方を参照してください
ここでの内容を実行すると、最悪リモートリポジトリの状態を破壊することがなります
:::

# 直前のコミットメッセージを修正したい

直前にコミットにある、コミットメッセージがTypoで変なメッセージになっていることがあります
その時は

```sh
git commit --amend -m '<commit-message>'
```

で書き換えることができます
`--amend`は、前回のコミットを修正するコマンドになります
例えば、前回のコミットメッセージが`hogehogeに修正`とあった時に`git commit --amend -m 'fugafugaに修正'`を実行すると、前回のコミットメッセージが`fugafugaに修正`になります

# 直前のコミットにファイルを追加したい

前回のコミットで`a.txt`をコミットしたけど、`b.txt`をコミットするのを忘れてた、ということもあります
こんな場合は

```sh
git add b.txt
git commit --amend --no-edit
```

で追加することができます
`git add`でコミット対象を指定して、`git commit --amend`で直前のコミットに今回のファイルを追加します
`--no-edit`を指定すると、コミットメッセージを編集せずにコミットすることができるので、コミットメッセージを編集しない場合は指定すると良いです(コミットメッセージも編集する場合は`-m`を指定してコミットメッセージを書きます)

# 直前のコミット自体なかったことにしたい

今までの操作は、直前のコミット自体に何らかの編集を行っていますが、ここではコミット自体なくしたいときです
解決する方法は大きく分けて2つになります

## `git reset`を使う

この方法はコミットの状態を戻すやり方になります
この場合は以下のコマンドを実行します

```sh
git reset [--soft | --hard] HEAD^
```

`[--soft | --hard]`は、どちらも指定しないか、どちらか片方だけ指定することができます
挙動がそれぞれで異なりますが、直前のコミットに戻る操作であることは変わりません

* `--soft`:直前でコミットしたファイルを`add`した状態で戻します
* 指定なし:直前でコミットしたファイルを`add`してない状態で戻します
* `--hard`:直前でコミットしたファイルの差分をなくした状態で戻します(完全に元の状態に戻る)

なお、ここで出てくる`HEAD`は、今自分が作業しているコミットになります
これに`^`(`~`でもOK)をつけると、HEADから一つ前のコミットを指すことができます
重ねて使うこともでき、`HEAD^^`だと2つ前、`HEAD^^^`だと3つ前を指すことができます
`HEAD^2`や`HEAD^3`と、数値で指定することも可能です

## `git revert HEAD`を使う

何らかの事情でコミット自体を消すことができない場合、こちらを使います
基本的な文法は以下になります

```sh
git revert <commit-id>
```

`commit-id`で出た差分を打ち消す様なコミットを行います
具体的には以下の様な操作が行われます

* 追加された行は削除される
* 逆に削除された行は追加される
* ファイルそのものが追加された場合は、そのファイルを削除する
* 逆にファイルそのものが削除された場合は、削除された時の状態でファイルを元に戻す

なので、追加された行やファイルが編集されていると、元に戻すことができませんが、`HEAD`であればコミットせずに追加で編集した場合を除き戻すことが可能です
