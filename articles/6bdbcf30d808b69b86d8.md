---
title: "LINEã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ•´ç†ã—ãŸãŠè©±"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Ruby","linebot","ãªã„ã‚‚ã®ä½œã‚‹ã‚·ãƒªãƒ¼ã‚º"]
published: true
---
ä»Šå›ã¯æ–°ãŸãªæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸãŠè©±ã§ã¯ãªãã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã¡ã‚‡ã£ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãã‚Œã„ã«ã—ã¾ã—ãŸï¼
å‰å›ã¾ã§æ©Ÿèƒ½è¿½åŠ ã§ã‚½ãƒ¼ã‚¹ã®æ•´ç†ãŒè¿½ã„ã¤ã„ã¦ç„¡ã‹ã£ãŸã®ã§ï¼Œã“ã‚Œã‹ã‚‰ã®é–‹ç™ºã‚’æ¥½ã«ã™ã‚‹ãŸã‚ã«ã‚‚ã—ã¾ã—ãŸï¼

# ä¸»ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å†…å®¹
å¤§ããå¤‰ãˆãŸã®ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‘¨ã‚Šã§ã™ï¼
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ã€é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚’è¡¨ã™JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™([å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://developers.line.me/ja/docs/messaging-api/reference/#anchor-e65d8a1fb213489f6475b06ad10f66b7b30b0072))ï¼

## ä»Šã¾ã§ã®ã‚½ãƒ¼ã‚¹
é€ä¿¡ã™ã‚‹åº¦ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ã¯é€ä¿¡ã—ã¦ã¾ã—ãŸï¼
å…·ä½“çš„ã«ã¯â†“ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã¾ã—ãŸï¼

```ruby
            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
            message = {
              type: 'text',
              text: sending_message
            }
            # å®Ÿéš›ã«é€ä¿¡
            client.reply_message(event['replyToken'], message)
            
            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
            message = {
              type: 'location',
              title: place_name,
              address: address,
              latitude: lat,
              longitude: lng
            }
            # å®Ÿéš›ã«é€ä¿¡
            client.push_message(accepting_user_id, message)
```

ã“ã‚Œã ã¨ï¼Œä½•ã‹é€ä¿¡ã™ã‚‹åº¦ã«æœ€ä½4è¡Œã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®ãŸã‚ã«ä½¿ã†ã“ã¨ã«ãªã‚Šï¼Œã‚³ãƒ¼ãƒ‰ãŒå†—é•·ã«ãªã‚Šã¾ã™(ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å‰ã¯ç”Ÿæˆã™ã‚‹ã ã‘ã§110è¡Œ25è¡Œãã‚‰ã„ä½¿ã£ã¦ã¾ã—ãŸ)ï¼

## ã“ã‚Œã‹ã‚‰ã®ã‚½ãƒ¼ã‚¹
ãªã®ã§ï¼Œä»Šå¾Œã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’å°‚ç”¨ã«ä½œã£ã¦ï¼Œãã“ã§å®Ÿéš›ã®ç”Ÿæˆã‚’ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸï¼

### ä¸‹æº–å‚™
ä»Šã¾ã§ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒãƒƒã‚·ãƒ¥ã§è¨­å®šã—ã¦ã„ãŸã®ã§ï¼Œã¾ãšã¯ã‚¯ãƒ©ã‚¹ã‚’ãƒãƒƒã‚·ãƒ¥ã«ã—ã¦ãã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼
ã¤ã„ã§ã«ï¼Œãƒ­ã‚°å‡ºåŠ›ã™ã‚‹ã“ã¨ã‚’è¦–é‡ã«å…¥ã‚Œã¦ï¼ŒJsonã‚‚ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼

```ruby:messageObject.rb
module MessageObject
  def to_json()
    JSON.generate(self.to_hash)
  end

  def to_hash()
    hash = {}
    self.instance_variables.each do |t|
      key_name = t.to_s.gsub(/@/, '')
      hash[key_name] = self.send(key_name)
    end

    hash
  end
end
```

### ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
ãã—ã¦ï¼Œä¸Šã‚’prependã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ï¼

```ruby:text.rb
require 'json'
require './public/ruby/line_dto/message_object'

class Text
  prepend MessageObject
  attr_reader :type
  attr_accessor :text

  def initialize(text)
    @type = 'text'
    @text = text
  end
end
```

```ruby:location.rb
require 'json'
require './public/ruby/line_dto/message_object'

class Location
  prepend MessageObject
  attr_reader :type
  attr_accessor :title, :address, :latitude, :longitude

  def initialize(title, address, lat, lng)
    @type = 'location'
    @title = title
    @address = address
    @latitude = lat
    @longitude = lng
  end
end
```

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆæ™‚ã«å¼•æ•°ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ï¼Œé€ä¿¡ã™ã‚‹å†…å®¹ã‚’ã‚»ãƒƒãƒˆã™ã‚‹æ§˜ã«ã—ã¦ã„ã¾ã™ï¼
ä»Šã®ã¨ã“ã‚ï¼Œä¸€åº¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ãŸã‚‰ï¼Œãã‚Œã‚’ä½¿ã„ã¾ã‚ã™ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã—ã¦ã„ã‚‹ã®ã§ï¼Œ`@type`ä»¥å¤–ã¯ã„ã¤ã§ã‚‚å€¤ã‚’ã‚»ãƒƒãƒˆã§ãã‚‹æ§˜ã«ãªã£ã¦ã„ã¾ã™ï¼

### çµæœ
ä½œã£ãŸã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹æ§˜ã«ï¼Œä»Šã¾ã§ã®ã‚½ãƒ¼ã‚¹ã«ã‚ã‚‹éƒ¨åˆ†ã‚’â†“ã®æ§˜ã«ä¿®æ­£ã—ã¾ã—ãŸï¼

```ruby
            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
            message = Text.new(sending_message)
            # å®Ÿéš›ã«é€ä¿¡
            client.reply_message(event['replyToken'], message.to_hash)

            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
            location = Location.new(place_name, address, lat, lng)
            # å®Ÿéš›ã«é€ä¿¡
            client.push_message(accepting_user_id, location.to_hash)
```

ã¨ã£ã¦ã‚‚ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸï¼
