---
title: "レガシープロジェクト改善失敗反省会"
emoji: "🤦‍♀️"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
執筆時点までで3回、レガシープロジェクトに参画しました。
レガシーなのは嫌なので、率先して可能な限りモダンなプロジェクトにしようと試みました。
ですが、最初のプロジェクト以外、見事に失敗しました・・・
なので、最初はなぜうまく行ったのか、他2回はなぜうまくいかなかったのかを反省してみます。

:::message
ここに書かれている内容は私が経験した内容、見聞をもとにしたフィクションです。
なんか凄く自分がいるプロジェクトと似ているな・・・って思われても、フィクションなので無関係です
:::

# 「レガシープロジェクト」「モダンプロジェクト」の定義

人によってレガシー、モダンの線引は異なる(そもそも、厳密な線引ができない気がする)ので、ここでは以下のプロジェクトをレガシープロジェクトと呼ぶことにします

* 設計書がない、または不完全である
  * 設計書が不完全な状態というのは、ソースコードと設計書が一致していない状態です(以下、例)
    * フロントエンド、バックエンドどちらも改修対象なのに、画面設計書だけまたはDB設計書だけ等、設計書自体が不足している
    * いずれかの改修内容がプログラムだけに反映されて、設計書には反映されていない
    * テスト仕様書がない
* テストが自動化されていない
* 成果物(各種設計書、ソースコード等)のレビューがされていない
* ローカル環境で開発ができない(開発環境等、共通の環境でプログラマが改修する様な体制)

箇条書きで書かれた項目が解消されるたび、「モダンプロジェクトに進む」と表現します。
全て解消されたとき、そのプロジェクトを「モダンプロジェクト」と言います。
~~CIを入れてないのにモダンプロジェクトって言うな!っていうマサカリが飛んで来そうですが、この記事の便宜上そうさせてください・・・~~

# モダンプロジェクトに成功したプロジェクト

## 前提

ソースコードやチームの状態など、大体こんな感じです

* チームは立ち上げたばかり
  * 立ち上げたばかりだが、後にリーダークラスになる方々は自分を含め元々同じチームだったので、面識はめちゃくちゃある
  * 私の立ち位置はプロダクトマネージャー、テックリードあたり
* ソースコードは引き継ぎ
  * 全体で1M行は軽く超えている
  * 一部のファイルは2k行を超えていた
  * テストコードはなし(=テストが自動化されていない)
* けど、設計書は一切なし
  * 最初に口頭で、主に改修する画面に関わる基本的な運用の流れや利用用途などを聞いたくらい

最初に聞いた仕様とソースの規模的に、明らかにソースが肥大化しまくっている状態でした。
なので、かなり細かい仕様が入り乱れているなーっていう印象だったと思います。

## 成功要因

詳細については後述しますが、大体↓になると思います。

* 協力者が多かった
* ソースコードや業務中に聞く用語を順次ドキュメントにした(できた)
* 定期的に日々の開発運用を見直した
* 何かをし始めるとき、優先順位をつけていた

### 協力者が多かった

多分、成功要因の大半を占めていると思います。
何をするにおいても、その人だけに任せるということがなかったと思います。
基本的にその人がメインに動いて、その人が躓いた事に気づいたら協力していく印象です。
いわゆる分報をしていたので、人数の割には躓いたことに気づいた件数が多かったのかなと思います。

### ソースコードや業務中に聞く用語を順次ドキュメントにした(できた)

一気にドキュメントにするのではなく、優先順位をつけて順次ドキュメントにしたのが成功の秘訣です。
そもそも、全体で1M行、1ファイルだけで1k行を超えるソースコードを一気にドキュメントにする気力すら起きませんでしたが、小規模でも順番にドキュメントにするのが良いと思います。

順次ドキュメントにするメリットは大まかに↓になります

* 負荷が分散するので、極端にドキュメント化に対するコストが減る(定常工数として加算しやすい)
* 誰かが最初に改修する際、一緒に仕様書を作る選択肢ができる
* ドキュメント作成スキルが未熟な人は小規模、成熟している人は中～大規模を担当する選択肢ができる

ドキュメントを作る時、優先順をつける要素としては↓になります。

1. 画面やAPIの利用頻度(業務運用時の重要度)
2. 改修するついでに
3. ソースコードが小規模
4. 手が空いたとき

3と4でドキュメント作成することはほぼなかった(ドキュメント化終盤くらいだったと思う)ですが、少なからず影響を与えたので一応記載しました。

### 定期的に日々の開発運用を見直した

改修の進捗にもよりますが、大体1ヶ月に1～2回は開発運用の見直しをしました。
具体的には↓の様な内容になります。

* 今の運用の問題点をベースに改善策を策定
  * 問題点は事前にSlackで共有していました
  * 全体の司会はリーダークラスの方がしていましたが、各問題点の司会は提案者がしていました(さり気なくメンバーの司会力を育てる)
* 改善策を実施している場合、どう影響したのかを見直す
  * 運用にかっちり乗った(自然と続けていける状態になっている)レベルなら、今後も続けていく
  * 別の問題が出たり効果的ではない場合、改善策を微調整したり、別の改善策を出す
* 問題があるからと言って、その場で改善策を出すことを強制しない
  * 今後の活動で改善策が見つかる可能性もある
  * だからと言って、雑には考えない(改善策を考える最低限の時間を決める)
* 基本的に全ての意見は受け入れる体制で臨む
  * いきなり否定ではなく、どういうメリットがあるか?というところから考える

チャレンジをしてみては、だめならやめる、良さそうなら微調整、完璧ならしばらくやる、という感じです。
全体の開発工数が少なくなったり、同じ開発工数でも品質が高めになったりするのが体感できました。
最終的にはちゃんと数値化していますが、定期的な見直しで足止めした分、見返りが効果的にもらえました。

ちなみに、このときに見直した方法はKPTですが、KPTの詳細はいろんな記事があるので割愛します。

### 何かをし始めるとき、優先順位をつけていた

開発運用の見直しの時点でチャレンジ精神旺盛さがにじみ出ています。
しかし、残念ながら本番にリリースする時刻はあるので、時間とその間にやれることは有限です。
なので、何かし始めるときは必ず優先順位をつけて、実際に改善策を実施したり、ツールを導入していました。

* 早めやればやるほど、最終的なコストダウンが見込める
  * 例えば、単体テストのソースコードは最初は学習コストがかかるけど、時間経過で少なくなっていき、テストの再実施やデグレ発見等のコストが減る等
* チーム全体で繰り返し行われる操作の自動化
* ツールのドキュメントがネット上にあるかどうか
  * 大体は検索件数や検索推移を参照
  * 件数が多い分、エラーが発生した時の対処や不具合修正が反映されやすくなるので、調査コストが少なめになりやすい
* 